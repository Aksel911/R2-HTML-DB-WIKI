    <!-- DataTables Initialization Script -->
    <script>
    $(document).ready(function() {
        window.table = $('#items-table').DataTable({
            "paging": true,
            "lengthChange": true,
            "searching": true,
            "ordering": true,
            "info": true,
            "autoWidth": false,
            "pageLength": 25,
            "deferRender": true,
            "order": [[ 0, "asc" ]],
            "columnDefs": [
                            {
                                "targets": 0,
                                "orderable": true,
                                "type": "num",
                                "render": function(data, type, row) {
                                    if (type === 'sort') {
                                        // Извлекаем data-sort-id для сортировки
                                        var sortId = $(data).find('.hover-text-wrapper').data('sort-id');
                                        return sortId || 0;
                                    }
                                    return data;
                                }
                            }
                        ],
            "dom": '<"top"lf>rt<"bottom"ip>',
            "processing": true,
            "language": {
                "processing": '<div class="loading-spinner"></div>',
                "search": "_INPUT_",
                "searchPlaceholder": "Быстрый фильтр...",
                "lengthMenu": "Показать _MENU_ монстров",
                "info": "Монстры с _START_ по _END_ из _TOTAL_",
                "infoEmpty": "Нет монстров",
                "zeroRecords": "Монстры не найдены",
                "paginate": {
                    "first": "Первая",
                    "last": "Последняя",
                    "next": "Следующая",
                    "previous": "Предыдущая"
                }
            },
            "drawCallback": function(settings) {
                initializeImageZoom();
                $('#items-table tbody tr').each(function(index) {
                    $(this).css('animation-delay', (index * 0.05) + 's');
                });
            },
            "initComplete": function(settings, json) {
                $('.dataTables_filter').hide();
                initializeKeyboardNavigation();
                cacheMonsterData();
            }
        });
    });
    </script>

    <!-- Image Handling Script -->
    <script>
    function initializeImageZoom() {
        $('.monster-image').each(function() {
            var $img = $(this);
            $img.off('mouseenter mouseleave');

            $img.hover(
                function() {
                    $(this).css({
                        'transform': 'scale(2)',
                        'z-index': '1000',
                        'transition': 'transform 0.3s ease'
                    });
                },
                function() {
                    $(this).css({
                        'transform': 'scale(1)',
                        'z-index': '1',
                        'transition': 'transform 0.3s ease'
                    });
                }
            );
        });
    }
    </script>

    <!-- Search Functionality Script -->
    <script>
    $(document).ready(function() {
        var searchTimeout;

        $('#search-input').on('input', function() {
            var $input = $(this);
            var searchText = $input.val().trim();

            clearTimeout(searchTimeout);
            $('.loading-spinner').fadeIn();

            searchTimeout = setTimeout(function() {
                window.table.search(searchText).draw();
                updateSearchSuggestions(searchText);
                $('.loading-spinner').fadeOut();
            }, 300);
        });

        function updateSearchSuggestions(searchText) {
            var $results = $('#search-results');
            $results.empty();

            if (searchText.length < 2) {
                $results.hide();
                return;
            }

            var matches = window.monsterCache
                .filter(function(monster) {
                    return monster.name.toLowerCase().includes(searchText.toLowerCase());
                })
                .slice(0, 5);

            if (matches.length > 0) {
                matches.forEach(function(match) {
                    var $link = $('<a>')
                        .addClass('dropdown-item')
                        .attr('href', '/monster/' + match.id)
                        .text(match.name)
                        .click(function(e) {
                            e.preventDefault();
                            $('#search-input').val(match.name);
                            window.table.search(match.name).draw();
                            $results.hide();
                        });
                    $results.append($link);
                });
                $results.show();
            } else {
                $results.hide();
            }
        }

        $(document).click(function(e) {
            if (!$(e.target).closest('.search-container').length) {
                $('#search-results').hide();
            }
        });
    });
    </script>

    <!-- Data Caching Script -->
    <script>
    function cacheMonsterData() {
        window.monsterCache = [];
        $('#items-table tbody tr').each(function() {
            var $row = $(this);
            var $nameCell = $row.find('td:eq(1) a');
            window.monsterCache.push({
                id: $nameCell.attr('href').split('/').pop(),
                name: $nameCell.text(),
                class: $row.find('td:eq(2)').text(),
                element: $row
            });
        });
    }
    </script>

    <!-- Keyboard Navigation Script -->
    <script>
    function initializeKeyboardNavigation() {
        $(document).keydown(function(e) {
            if (e.ctrlKey && e.keyCode === 70) {
                e.preventDefault();
                $('#search-input').focus();
            }

            if (e.keyCode === 27) {
                $('#search-input').val('').trigger('input');
                $('#search-results').hide();
            }

            if (!$('#search-input').is(':focus')) {
                if (e.keyCode === 37) {
                    window.table.page('previous').draw('page');
                } else if (e.keyCode === 39) {
                    window.table.page('next').draw('page');
                }
            }
        });
    }
    </script>

    <!-- Export Functionality Script -->
    <script>
    $(document).ready(function() {
        $('#export-csv').click(function() {
            $('.loading-spinner').fadeIn();

            setTimeout(function() {
                var csvContent = "data:text/csv;charset=utf-8,\uFEFF";

                var headers = [];
                $('#items-table thead th').each(function() {
                    headers.push('"' + $(this).text() + '"');
                });
                csvContent += headers.join(",") + "\n";

                $('#items-table tbody tr').each(function() {
                    var row = [];
                    $(this).find('td').each(function(index) {
                        if (index === 0) {
                            row.push('""');
                        } else {
                            row.push('"' + $(this).text() + '"');
                        }
                    });
                    csvContent += row.join(",") + "\n";
                });

                var encodedUri = encodeURI(csvContent);
                var link = document.createElement("a");
                link.setAttribute("href", encodedUri);
                link.setAttribute("download", "monsters_" + new Date().toISOString().slice(0,10) + ".csv");
                document.body.appendChild(link);

                link.click();
                document.body.removeChild(link);
                $('.loading-spinner').fadeOut();
            }, 100);
        });
    });
    </script>

    <!-- Dropdown Menu Script -->
    <script>
    $(document).ready(function() {
        let timeout;
        const DELAY = 300;

        $('.nav-item.dropdown').hover(
            function() {
                clearTimeout(timeout);
                const $dropdown = $(this);
                $('.nav-item.dropdown').not($dropdown).find('.dropdown-menu').hide();
                $dropdown.find('.dropdown-menu').show();
            },
            function() {
                const $dropdown = $(this);
                timeout = setTimeout(function() {
                    if (!$dropdown.find('.dropdown-menu:hover').length) {
                        $dropdown.find('.dropdown-menu').hide();
                    }
                }, DELAY);
            }
        );

        $('.dropdown-menu').hover(
            function() {
                clearTimeout(timeout);
            },
            function() {
                const $menu = $(this);
                timeout = setTimeout(function() {
                    $menu.hide();
                }, DELAY);
            }
        );

        $('.dropdown-item').click(function(e) {
            const href = $(this).attr('href');
            if (href) {
                window.location.href = href;
            }
        });
    });
    </script>

    <!-- Window Resize Handler Script -->
    <script>
    $(document).ready(function() {
        $(window).resize(_.debounce(function() {
            window.table.columns.adjust();
        }, 250));
    });
    </script>

    <!-- Tooltip Initialization Script -->
    <script>
    $(document).ready(function() {
        $('[data-toggle="tooltip"]').tooltip();
    });
    </script>





    <!-- Inline Theme Check Script - Place in <head> -->
    <script>
        // Немедленно проверяем и применяем тему до загрузки DOM
        (function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark-theme');
                document.body.classList.add('dark-theme');
            }
        })();
    </script>

    <!-- Dark Theme Toggle Script -->
    <script>
        document.getElementById('theme-toggle').addEventListener('click', () => {
            document.documentElement.classList.toggle('dark-theme');
            document.body.classList.toggle('dark-theme');
            localStorage.setItem('theme',
                document.documentElement.classList.contains('dark-theme') ? 'dark' : 'light'
            );
        });
    </script>


